<section class="panel" th:fragment="rpcStatus">
    <div style="display: flex; align-items: center; gap: 12px;">
        <h2 style="margin: 0;">RPC Status</h2>
        <span th:if="${view.referenceNode}" style="background-color: #808080; color: #ffffff; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.75rem;">REFERENCE</span>
    </div>
    <div class="status-grid">
        <div class="status-item">
            <span class="status-light"
                th:classappend="${view.httpConfigured} ? (${view.httpUp} ? ' status-http-up' : ' status-error') : ' status-off'"></span>
            <span>HTTP RPC</span>
        </div>
        <div class="status-item">
            <span class="status-light"
                th:classappend="${view.wsConfigured} ? (${view.wsUp} ? ' status-ws-up' : ' status-error') : ' status-off'"></span>
            <span>WebSocket RPC</span>
        </div>
        <div class="status-item">
            <span class="label">Latest Block</span>
            <span th:text="${view.latestBlockNumber != null ? view.latestBlockNumber : '-'}">-</span>
        </div>
        <div class="status-item">
            <span class="label">Last Block Age <span class="hint" data-hint="Time elapsed since the most recent block timestamp seen by this node.">?</span></span>
            <span th:if="${view.lastBlockAgeMs != null}"
                th:classappend="${view.lastBlockAgeMs < 15000 ? ' age-fresh' : (view.lastBlockAgeMs < 60000 ? ' age-warn' : ' age-stale')}"
                th:text="${view.lastBlockAgeMs < 1000 ? view.lastBlockAgeMs + 'ms' : (view.lastBlockAgeMs < 60000 ? #numbers.formatDecimal(view.lastBlockAgeMs / 1000.0, 1, 1) + 's' : #numbers.formatDecimal(view.lastBlockAgeMs / 60000.0, 1, 1) + 'm')}">-</span>
            <span th:if="${view.lastBlockAgeMs == null}" class="muted">-</span>
        </div>
    </div>
    <div class="rpc-columns">
        <div class="rpc-column">
            <h3>HTTP</h3>
            <div class="rpc-item">
                <span class="label">HTTP Connected</span>
                <span
                    th:text="${view.httpStatus.connectedSince != null ? #temporals.format(view.httpStatus.connectedSince, 'yyyy-MM-dd HH:mm:ss') : '-'}">-</span>
            </div>
            <div class="rpc-item">
                <span class="label">Current Error</span>
                <span th:text="${view.httpStatus.lastError != null ? view.httpStatus.lastError : '-'}">-</span>
            </div>
        </div>
        <div class="rpc-column">
            <h3>WebSocket</h3>
            <div class="rpc-item">
                <span class="label">WS Connected</span>
                <span
                    th:text="${view.wsStatus.connectedSince != null ? #temporals.format(view.wsStatus.connectedSince, 'yyyy-MM-dd HH:mm:ss') : '-'}">-</span>
            </div>
            <div class="rpc-item">
                <span class="label">Current Error, Reconnections <span class="hint" data-hint="Last WebSocket error message and total reconnection count since startup.">?</span></span>
                <span th:text="${(view.wsStatus.lastError != null ? view.wsStatus.lastError : '-') + ' (' + view.wsStatus.disconnectCount + ')'}">- (0)</span>
            </div>
        </div>
    </div>
</section>
