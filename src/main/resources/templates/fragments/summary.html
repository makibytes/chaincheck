<section class="summary-grid" th:fragment="summary">
    <div class="card">
        <h3>Samples &amp; Errors</h3>
        <div class="card-row">
            <span class="card-label muted">HTTP: <span class="hint" data-hint="Number of HTTP polling calls made in the selected time range.">?</span></span>
            <span class="card-value" th:text="${view.summary.httpSamples}">0</span>
        </div>
        <div class="card-row">
            <span class="card-label muted">WS: <span class="hint" data-hint="Number of WebSocket new-head events received.">?</span></span>
            <span class="card-value" th:text="${view.summary.wsSamples}">0</span>
        </div>
        <div class="card-row">
            <span class="card-label muted">Errors:</span>
            <span class="card-value" th:text="${view.summary.errorCount}">0</span>
        </div>
        <div class="card-row">
            <span class="card-label muted">Uptime: <span class="hint" data-hint="Successful calls ÷ total calls × 100, over the selected time range.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.uptimePercent, 1, 1)}">0</span><span class="card-unit muted">%</span></span>
        </div>
    </div>
    <div class="card anomalies-card">
        <h3>Anomalies</h3>
        <div class="anomaly-grid">
            <div class="card-row">
                <span class="card-label muted">Delay: <span class="hint" data-hint="High-latency or slow-sync anomalies: HTTP round-trip exceeded the configured threshold, or the node was behind the reference head.">?</span></span>
                <span class="card-value" th:text="${view.summary.delayCount}">0</span>
            </div>
            <div class="card-row">
                <span class="card-label muted">Reorg: <span class="hint" data-hint="Chain reorganizations: a new head whose parent hash did not extend the previous canonical tip.">?</span></span>
                <span class="card-value" th:text="${view.summary.reorgCount}">0</span>
            </div>
            <div class="card-row" th:if="${view.summary.maxReorgDepth > 0}">
                <span class="card-label muted">Max Reorg Depth: <span class="hint" data-hint="Deepest reorganization observed — how many blocks were rolled back in a single reorg.">?</span></span>
                <span class="card-value" th:text="${view.summary.maxReorgDepth} + ' blk'">0</span>
            </div>
            <div class="card-row">
                <span class="card-label muted">Timeout: <span class="hint" data-hint="HTTP requests that did not receive a response within the configured timeout.">?</span></span>
                <span class="card-value" th:text="${view.summary.timeoutCount}">0</span>
            </div>
            <div class="card-row">
                <span class="card-label muted">Rate Limit: <span class="hint" data-hint="HTTP 429 or similar rate-limit responses received from the node.">?</span></span>
                <span class="card-value" th:text="${view.summary.rateLimitCount}">0</span>
            </div>
            <div class="card-row">
                <span class="card-label muted">Block Gap: <span class="hint" data-hint="One or more consecutive block numbers were missing, indicating dropped WebSocket events or a stalled node.">?</span></span>
                <span class="card-value" th:text="${view.summary.blockGapCount}">0</span>
            </div>
            <div class="card-row" th:if="${view.summary.maxGapSize > 0}">
                <span class="card-label muted">Max Gap Size: <span class="hint" data-hint="Largest number of consecutive blocks missing in a single gap event.">?</span></span>
                <span class="card-value" th:text="${view.summary.maxGapSize} + ' blk'">0</span>
            </div>
            <div class="card-row">
                <span class="card-label muted">Error: <span class="hint" data-hint="Generic RPC failures not classified as Timeout or Rate Limit (e.g. connection refused, unexpected HTTP status).">?</span></span>
                <span class="card-value" th:text="${view.summary.errorAnomalyCount}">0</span>
            </div>
            <div class="card-row">
                <span class="card-label muted">Stale: <span class="hint" data-hint="HTTP polls that found a block whose age (block timestamp → poll time) exceeded the stale-block threshold.">?</span></span>
                <span class="card-value" th:text="${view.summary.staleBlockCount}">0</span>
            </div>
        </div>
        <div class="card-row anomalies-card-row-full">
            <span class="card-label muted">Wrong Head (percentage): <span class="hint" data-hint="Times this node's latest block hash disagreed with the consensus (reference) head.">?</span></span>
            <span class="card-value">
                <span th:text="${view.summary.wrongHeadCount}">0</span>
                <span th:if="${view.summary.wrongHeadRatePercent > 0}" class="muted card-unit"
                    th:text="'(' + ${#numbers.formatDecimal(view.summary.wrongHeadRatePercent, 1, 1)} + '%)'"></span>
            </span>
        </div>
    </div>
    <div class="card metric-card">
        <h3>Network Latency</h3>
        <div class="card-row">
            <span class="card-label muted">Avg: <span class="hint" data-hint="Mean HTTP round-trip time across all calls in the selected range.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.avgLatencyMs, 1, 2)}">0</span><span class="card-unit muted">ms</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P95: <span class="hint" data-hint="95th-percentile HTTP round-trip time. 95% of all requests completed faster than this value.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p95LatencyMs, 1, 2)}">0</span><span class="card-unit muted">ms</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P99: <span class="hint" data-hint="99th-percentile HTTP round-trip time. 99% of all requests completed faster than this value.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p99LatencyMs, 1, 2)}">0</span><span class="card-unit muted">ms</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">IQR Jitter: <span class="hint" data-hint="Interquartile range (P75 − P25). Measures latency consistency — a high value means response times are erratic.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p75LatencyMs - view.summary.p25LatencyMs, 1, 1)}">0</span><span class="card-unit muted">ms</span></span>
        </div>
    </div>
    <div class="card metric-card" th:if="${view.wsConfigured}">
        <h3>New Blocks</h3>
        <div class="card-row">
            <span class="card-label muted">Avg: <span class="hint" data-hint="Mean time between a block's own timestamp and when this node first reported it via WebSocket.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.avgNewBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P95: <span class="hint" data-hint="95th-percentile head delay. 95% of new blocks arrived within this time of their own timestamp.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p95NewBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P99: <span class="hint" data-hint="99th-percentile head delay. 99% of new blocks arrived within this time of their own timestamp.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p99NewBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
    </div>
    <div class="card metric-card" th:if="${view.safeBlocksEnabled}">
        <h3>Safe Blocks</h3>
        <div class="card-row">
            <span class="card-label muted">Avg: <span class="hint" data-hint="Mean time from block production until this node confirmed it as 'safe'.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.avgSafeBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P95: <span class="hint" data-hint="95th-percentile safe-confirmation delay. 95% of blocks were confirmed safe within this time.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p95SafeBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P99: <span class="hint" data-hint="99th-percentile safe-confirmation delay.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p99SafeBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
    </div>
    <div class="card metric-card" th:if="${view.finalizedBlocksEnabled}">
        <h3>Finalized Blocks</h3>
        <div class="card-row">
            <span class="card-label muted">Avg: <span class="hint" data-hint="Mean time from block production until this node confirmed it as 'finalized' (irreversible).">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.avgFinalizedBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P95: <span class="hint" data-hint="95th-percentile finalization delay. 95% of blocks were finalized within this time.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p95FinalizedBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">P99: <span class="hint" data-hint="99th-percentile finalization delay.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p99FinalizedBlockPropagationMs / 1000, 1, 2)}">0</span><span class="card-unit muted">s</span></span>
        </div>
    </div>
    <div class="card metric-card">
        <h3>Block Quality</h3>
        <div class="card-row">
            <span class="card-label muted">Valid: <span class="hint" data-hint="Percentage of unique blocks seen that were not orphaned by a competing canonical block.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.canonicalRatePercent, 1, 1)}">100</span><span class="card-unit muted">%</span></span>
        </div>
        <div class="card-row">
            <span class="card-label muted">Orphaned: <span class="hint" data-hint="Blocks replaced by a different canonical block at the same parent position (chain reorganization victims).">?</span></span>
            <span class="card-value" th:text="${view.summary.invalidBlockCount}">0</span>
        </div>
        <div class="card-row" th:if="${view.multiNodeConfigured}">
            <span class="card-label muted">First Seen: <span class="hint" data-hint="95th-percentile of how many milliseconds behind the first node to report each block this node was. 0 means this node was consistently fastest.">?</span></span>
            <span class="card-value"><span th:text="${#numbers.formatDecimal(view.summary.p95FirstSeenDeltaMs, 1, 0)}">0</span><span class="card-unit muted">ms</span></span>
        </div>
    </div>
</section>
